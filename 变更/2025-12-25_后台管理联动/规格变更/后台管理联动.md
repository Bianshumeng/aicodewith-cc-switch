# 后台管理联动 - 变更

## 新增需求

### 需求：设备配置同步

客户端必须在启动后 1 小时执行一次同步，并在北京时间每日 04:00 再执行一次同步，将当前三平台配置（Claude/Codex/Gemini）上传至管理端。

#### 场景：启动后延迟同步
- **当** 客户端启动满 1 小时
- **那么** 应上传当前配置并记录同步成功时间

#### 场景：每日 04:00 同步
- **当** 客户端在 04:00 处于运行状态
- **那么** 应上传当前配置并记录同步成功时间

#### 场景：错过同步窗口
- **当** 客户端在 04:00 未运行
- **那么** 不补偿 04:00 同步，等待下一次 04:00 执行

### 需求：管理端静默下发

管理端下发配置后，客户端下次同步时应自动应用并覆盖本地配置，且不在 UI 中提示。

#### 场景：收到管理端配置
- **当** 管理端存在可下发配置版本
- **那么** 客户端应静默覆盖本地并更新 Live 配置文件

### 需求：IP 地区识别记录

管理端应根据客户端请求 IP 记录地区信息，供后续分公司统计。

#### 场景：同步请求
- **当** 管理端收到同步请求
- **那么** 服务端记录 IP 解析得到的地区信息

### 需求：设备标识

客户端必须使用硬件指纹作为设备标识，并在所有同步请求中携带。

#### 场景：首次同步
- **当** 客户端首次执行同步
- **那么** 生成硬件指纹并持久化为 device_id

### 需求：离线可用

客户端在无网络情况下仍可正常使用本地配置，网络恢复后按规则同步。

#### 场景：离线使用
- **当** 客户端离线
- **那么** 本地配置不受影响且不阻塞应用使用

### 需求：管理端 UI

管理端必须提供 Web UI，用于设备列表、配置查看与批量下发配置。

#### 场景：查看设备与配置
- **当** 管理员打开管理端 UI
- **那么** 可查看设备列表、设备详情与配置快照（JSON 原样展示，支持复制）

#### 场景：批量下发配置
- **当** 管理员在 UI 中选择多个设备并提交配置 JSON
- **那么** 管理端应为所选设备生成新的下发配置版本

### 需求：管理端信息不暴露

客户端不得在 UI 中展示管理端地址或同步 Token，且不提供运行时覆盖入口。

#### 场景：客户端界面检查
- **当** 用户打开客户端页面
- **那么** 页面不展示管理端地址/Token 等后台相关信息
