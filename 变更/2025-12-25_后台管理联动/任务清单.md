# 任务清单

## 1. 准备阶段
- [x] 1.1 阅读现有规格 `规格/后台管理联动.md`（如不存在则创建变更规格）
- [x] 1.2 确认没有冲突的进行中变更

## 2. 实现阶段
- [x] 2.1 新增 `server/` 基础工程、数据库迁移与健康检查 | 验收：服务端启动后 `GET /healthz` 返回 OK
- [x] 2.2 实现设备同步 API（存储客户端配置快照） | 验收：`POST /api/v1/devices/sync` 写入数据库并返回响应
- [x] 2.3 实现管理端下发 API（静默覆盖配置） | 验收：下发后客户端下次同步应用成功
- [x] 2.4 服务端接入 IP 地区识别（MaxMind 本地库） | 验收：同步记录带上地区字段
- [x] 2.5 客户端生成硬件指纹并持久化 | 验收：本地 settings 记录 device_id
- [x] 2.6 客户端定时同步（北京时间 04:00） | 验收：日志记录到时触发并完成同步
- [x] 2.7 客户端静默应用管理端配置 | 验收：本地供应商被覆盖且 Live 配置更新
- [x] 2.8 Docker 化与部署说明 | 验收：根目录存在 `DEPLOYMENT.md` 且可直接运行 compose
- [x] 2.9 管理端设备查询与批量下发 API | 验收：设备列表/详情/批量下发接口可用
- [x] 2.10 管理端 Web UI（设备列表、配置查看、批量下发） | 验收：可完成批量下发与复制配置

## 3. 验证阶段
- [ ] 3.1 本地模拟断网/联网后同步流程 | 验收：离线不阻塞，联网时同步成功
- [ ] 3.2 管理端下发覆盖验证 | 验收：客户端无提示应用并生效
- [ ] 3.3 管理端 UI 验收 | 验收：设备列表/配置详情/批量下发可用

## 4. 收尾阶段
- [ ] 4.1 更新规格文档（合并变更到 `规格/`）
- [ ] 4.2 归档本次变更（移动到 `变更/归档/`）

## 经验记录

### 步骤 2.1 完成记录
- 实际情况：
- 遇到问题：
- 技术债：

## 技术债台账

- [ ] TD-001：`server/src/main.rs` 已达 592 行，超过单文件 400 行阈值
  - 影响面：管理端 API、鉴权、静态资源服务均集中于单文件，后续扩展易失控
  - 推荐处理时限：下一次新增管理端接口或 UI 能力前进行模块化拆分
  - 暂缓原因：当前阶段需要快速闭环管理端最小可用链路，立即拆分会带来模块边界反复调整
  - 回收节点：新增管理端接口/统计面板功能前触发拆分
  - 责任模块：管理端服务端（Axum）
